<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoodData Calculator - Complete Professional Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 1em; height: 1em; stroke: currentColor; stroke-width: 2; fill: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Simple icons as SVG components
        const Calculator = () => <svg className="lucide" viewBox="0 0 24 24"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="m16 10-4 4-4-4"/></svg>;
        const Database = () => <svg className="lucide" viewBox="0 0 24 24"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="m3 5v14c0 3 4 3 9 3s9 0 9-3V5"/><path d="m3 12c0 3 4 3 9 3s9 0 9-3"/></svg>;
        const Users = () => <svg className="lucide" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="m22 21-3-3"/><path d="m16 8 2-2"/></svg>;
        const FileText = () => <svg className="lucide" viewBox="0 0 24 24"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>;
        const Settings = () => <svg className="lucide" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const Building = () => <svg className="lucide" viewBox="0 0 24 24"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12h4"/><path d="M6 8h4"/><path d="M6 16h4"/><path d="M14 12h4"/><path d="M14 16h4"/><path d="M14 8h4"/><path d="M6 22h12"/></svg>;
        const DollarSign = () => <svg className="lucide" viewBox="0 0 24 24"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;

        // Fixed Supabase Storage (NO localStorage usage)
        class SupabaseStorage {
            constructor() {
                this.supabaseUrl = 'https://ysaxvpcwlmxdbietmjrl.supabase.co';
                this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzYXh2cGN3bG14ZGJpZXRtanJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQxNzYwOTMsImV4cCI6MjA0OTc1MjA5M30.D6CXJo9KBLHfEovgI-5Z4qFQJSPmC_jpc3MiOy3zd';
                // Use Map for in-memory storage only (no localStorage)
                this.quotes = new Map();
                console.log('üéØ Fixed Supabase Storage initialized (cloud-only)!');
            }

            async callSupabase(method, endpoint, body = null) {
                const url = `${this.supabaseUrl}/rest/v1/${endpoint}`;
                console.log(`üîÑ ${method} ${endpoint}...`);
                
                try {
                    const options = {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': this.supabaseKey,
                            'Authorization': `Bearer ${this.supabaseKey}`,
                            'Prefer': 'return=minimal'
                        }
                    };
                    
                    if (body) {
                        options.body = JSON.stringify(body);
                    }
                    
                    const response = await fetch(url, options);
                    
                    if (response.ok) {
                        console.log(`‚úÖ Supabase ${method} successful!`);
                        return method === 'GET' ? await response.json() : { success: true };
                    } else {
                        const errorText = await response.text();
                        console.log(`‚ùå Supabase error ${response.status}:`, errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.log(`‚ùå Supabase ${method} failed:`, error.message);
                    throw error;
                }
            }

            async save(code, data) {
                console.log(`üìù Saving quote "${code}" to Supabase cloud...`);
                
                const quoteData = {
                    data: data,
                    timestamp: new Date().toISOString(),
                    code: code,
                    version: '2.0'
                };
                
                // Store in memory
                this.quotes.set(code, quoteData);
                
                let cloudSaved = false;
                let cloudError = null;
                
                try {
                    // Try to update existing record first
                    try {
                        await this.callSupabase('PATCH', `Quotes?code=eq.${code}`, {
                            data: data,
                            updated_at: new Date().toISOString()
                        });
                        cloudSaved = true;
                        console.log('‚úÖ Updated existing record in Supabase');
                    } catch (updateError) {
                        // If update fails, create new record
                        await this.callSupabase('POST', 'Quotes', {
                            code: code,
                            data: data,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        });
                        cloudSaved = true;
                        console.log('‚úÖ Created new record in Supabase');
                    }
                } catch (e) {
                    cloudError = e.message;
                    console.log('‚ùå Cloud save failed:', cloudError);
                }
                
                return {
                    success: cloudSaved,
                    code: code,
                    cloudSaved: cloudSaved,
                    error: cloudError,
                    timestamp: new Date().toISOString()
                };
            }

            async load(code) {
                console.log(`üìñ Loading quote "${code}" from Supabase...`);
                
                try {
                    const data = await this.callSupabase('GET', `Quotes?code=eq.${code}&select=*`);
                    
                    if (data && data.length > 0) {
                        console.log('‚úÖ Loaded from Supabase cloud!');
                        const record = data[0];
                        
                        const quoteData = {
                            data: record.data,
                            timestamp: record.updated_at || record.created_at,
                            code: code,
                            version: '2.0'
                        };
                        
                        // Store in memory for this session
                        this.quotes.set(code, quoteData);
                        
                        return {
                            success: true,
                            data: record.data,
                            code: code,
                            source: 'supabase',
                            timestamp: record.updated_at || record.created_at
                        };
                    }
                } catch (e) {
                    console.log('‚ùå Supabase load failed:', e.message);
                }

                // Check in-memory storage as fallback
                if (this.quotes.has(code)) {
                    console.log('‚úÖ Loaded from session memory');
                    const quoteData = this.quotes.get(code);
                    return {
                        success: true,
                        data: quoteData.data,
                        code: code,
                        source: 'memory',
                        timestamp: quoteData.timestamp
                    };
                }

                console.log(`‚ùå Quote "${code}" not found`);
                return { 
                    success: false, 
                    error: 'Quote not found in cloud database',
                    code: code
                };
            }

            getAllCodes() {
                return Array.from(this.quotes.keys()).sort();
            }
        }

        const cloudStorage = new SupabaseStorage();

        function GoodDataCalculator() {
            const [activeTab, setActiveTab] = useState('main');
            const [templateCode, setTemplateCode] = useState('');
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);
            const [cloudStatus, setCloudStatus] = useState('');
            
            const [formData, setFormData] = useState({
                prospectName: '',
                clientWebsite: '',
                annualRevenue: '',
                budget: '',
                objectives: '',
                totalWorkspaces: '',
                biWorkspaces: '',
                aiWorkspaces: '',
                llmProvider: '',
                package: '',
                professionalServices: '',
                additionalEnvironments: false,
                samlOidc: false,
                dataCenterRegions: false,
                usageAnalytics: false,
                auditLog: false,
                hipaaCompliance: false,
                aeComments: '',
                financeComments: ''
            });

            const [pricing] = useState({
                platformFee: 36000,
                biWorkspacePrice: 25,
                aiWorkspacePrice: 10,
                advisory: 10000,
                analytics: 37500,
                endToEnd: 100000,
                additionalEnvironments: 12000,
                samlOidc: 3000,
                dataCenterRegions: 5000,
                usageAnalytics: 2500,
                auditLog: 3000,
                hipaaCompliance: 8000,
                llmPackages: {
                    'Customer': { 'Small': 100, 'Medium': 430, 'Large': 750 },
                    'GoodData': { 'Small': 200, 'Medium': 860, 'Large': 1500 }
                }
            });

            const handleInputChange = (field, value) => {
                setFormData(prev => {
                    const newData = { ...prev, [field]: value };
                    if (field === 'totalWorkspaces') {
                        newData.biWorkspaces = value;
                    }
                    return newData;
                });
            };

            const calculateTotal = () => {
                const bi = parseInt(formData.biWorkspaces) || 0;
                const ai = parseInt(formData.aiWorkspaces) || 0;
                
                let total = pricing.platformFee + (bi * pricing.biWorkspacePrice * 12) + (ai * pricing.aiWorkspacePrice * 12);
                
                if (formData.llmProvider && formData.package) {
                    const monthlyCost = pricing.llmPackages[formData.llmProvider]?.[formData.package] || 0;
                    total += monthlyCost * 12;
                }
                
                if (formData.professionalServices === 'Advisory') total += pricing.advisory;
                if (formData.professionalServices === 'Analytics') total += pricing.analytics;
                if (formData.professionalServices === 'End-to-end') total += pricing.endToEnd;
                if (formData.additionalEnvironments) total += pricing.additionalEnvironments;
                if (formData.samlOidc) total += pricing.samlOidc;
                if (formData.dataCenterRegions) total += pricing.dataCenterRegions;
                if (formData.usageAnalytics) total += pricing.usageAnalytics;
                if (formData.auditLog) total += pricing.auditLog;
                if (formData.hipaaCompliance) total += pricing.hipaaCompliance;
                
                return total;
            };

            const getPlatformCosts = () => {
                const bi = parseInt(formData.biWorkspaces) || 0;
                const ai = parseInt(formData.aiWorkspaces) || 0;
                const llmMonthlyCost = formData.llmProvider && formData.package ? 
                    (pricing.llmPackages[formData.llmProvider]?.[formData.package] || 0) : 0;
                
                return {
                    platformFee: pricing.platformFee,
                    biWorkspaces: bi * pricing.biWorkspacePrice * 12,
                    aiWorkspaces: ai * pricing.aiWorkspacePrice * 12,
                    llmPackage: llmMonthlyCost * 12
                };
            };

            const getProfessionalServicesCost = () => {
                if (formData.professionalServices === 'Advisory') return pricing.advisory;
                if (formData.professionalServices === 'Analytics') return pricing.analytics;
                if (formData.professionalServices === 'End-to-end') return pricing.endToEnd;
                return 0;
            };

            const getPremiumFeaturesCost = () => {
                let total = 0;
                if (formData.additionalEnvironments) total += pricing.additionalEnvironments;
                if (formData.samlOidc) total += pricing.samlOidc;
                if (formData.dataCenterRegions) total += pricing.dataCenterRegions;
                if (formData.usageAnalytics) total += pricing.usageAnalytics;
                if (formData.auditLog) total += pricing.auditLog;
                if (formData.hipaaCompliance) total += pricing.hipaaCompliance;
                return total;
            };

            const generateCode = () => {
                let companyPart = 'PROSPECT';
                if (formData.prospectName) {
                    companyPart = formData.prospectName
                        .replace(/[^a-zA-Z0-9]/g, '')
                        .toUpperCase()
                        .substring(0, 8);
                }
                
                const now = new Date();
                const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 
                                    'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
                const month = monthNames[now.getMonth()];
                const day = now.getDate().toString().padStart(2, '0');
                
                return `${companyPart}-${month}${day}`;
            };

            const saveQuote = async () => {
                if (!formData.prospectName) {
                    setMessage('‚ùå Please enter a prospect name before saving');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                const code = generateCode();
                setLoading(true);
                setMessage('üîÑ Saving to Supabase cloud database...');
                setCloudStatus('Connecting to cloud storage...');
                
                try {
                    const result = await cloudStorage.save(code, formData);
                    
                    if (result.cloudSaved) {
                        setMessage(`‚úÖ Quote saved to cloud: ${code} - Share this code anywhere! üåç`);
                        setCloudStatus('‚òÅÔ∏è Successfully saved to Supabase database');
                    } else {
                        setMessage(`‚ùå Cloud save failed: ${code} - ${result.error || 'Connection error'}`);
                        setCloudStatus(`‚ùå Unable to connect to cloud: ${result.error?.substring(0, 50) || 'Network issue'}`);
                    }
                    
                    setTimeout(() => {
                        setMessage('');
                        setCloudStatus('');
                    }, 6000);
                    
                } catch (error) {
                    setMessage('‚ùå Unexpected error during save - please try again');
                    setCloudStatus('‚ùå System error occurred');
                    setTimeout(() => {
                        setMessage('');
                        setCloudStatus('');
                    }, 4000);
                }
                
                setLoading(false);
            };

            const loadQuote = async () => {
                if (!templateCode.trim()) {
                    setMessage('‚ùå Please enter a quote code');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                setLoading(true);
                setMessage('üîÑ Loading from cloud database...');
                setCloudStatus('Searching Supabase database...');
                
                try {
                    const result = await cloudStorage.load(templateCode.toUpperCase());
                    
                    if (result.success) {
                        setFormData(result.data);
                        const sourceIcon = result.source === 'supabase' ? '‚òÅÔ∏è' : 'üíæ';
                        const sourceText = result.source === 'supabase' ? 'Supabase cloud' : 'session memory';
                        
                        setMessage(`‚úÖ Quote "${result.code}" loaded from ${sourceText}! ${sourceIcon}`);
                        setCloudStatus(`${sourceIcon} Source: ${sourceText} | Last updated: ${new Date(result.timestamp).toLocaleString()}`);
                        setTemplateCode('');
                        
                        setTimeout(() => {
                            setMessage('');
                            setCloudStatus('');
                        }, 5000);
                    } else {
                        setMessage(`‚ùå Quote "${templateCode.toUpperCase()}" not found in cloud database`);
                        setCloudStatus('‚ùå Searched cloud database - quote does not exist');
                        setTimeout(() => {
                            setMessage('');
                            setCloudStatus('');
                        }, 4000);
                    }
                } catch (error) {
                    setMessage('‚ùå Load failed - connection error');
                    setCloudStatus('‚ùå Unable to reach cloud database');
                    setTimeout(() => {
                        setMessage('');
                        setCloudStatus('');
                    }, 4000);
                }
                
                setLoading(false);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 via-white to-violet-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-green-600 to-emerald-500 rounded-xl shadow-xl text-white p-6 mb-6">
                            <div className="flex items-center gap-4">
                                <div className="bg-white/20 p-3 rounded-xl">
                                    <Database className="w-8 h-8" />
                                </div>
                                <div className="flex-1">
                                    <h1 className="text-2xl font-bold mb-2">üîß FIXED CLOUD CALCULATOR!</h1>
                                    <div className="text-sm bg-white/20 rounded-lg p-3">
                                        <strong>Database connection fixed!</strong> Removed localStorage (not supported in Claude) - now using pure Supabase cloud storage!
                                    </div>
                                </div>
                                <div className="text-right text-sm opacity-90">
                                    <div>‚úÖ Supabase cloud only</div>
                                    <div>üö´ No localStorage</div>
                                    <div>üåç Share anywhere</div>
                                </div>
                            </div>
                        </div>

                        {/* Main Calculator */}
                        <div className="bg-white rounded-2xl shadow-xl border border-gray-100 p-8 mb-8">
                            <div className="flex items-center gap-4 mb-6">
                                <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-900 to-pink-500 bg-clip-text text-transparent">
                                    GoodData Professional Calculator
                                </h1>
                                <div className="bg-gradient-to-r from-purple-900 to-pink-500 p-3 rounded-xl">
                                    <Calculator className="w-8 h-8 text-white" />
                                </div>
                            </div>
                            
                            <div className="grid md:grid-cols-2 gap-4 mb-6">
                                <input 
                                    type="text"
                                    placeholder="Prospect/Customer Name *"
                                    className="w-full p-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    value={formData.prospectName}
                                    onChange={(e) => handleInputChange('prospectName', e.target.value)}
                                />
                                <input 
                                    type="url"
                                    placeholder="Client Website"
                                    className="w-full p-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    value={formData.clientWebsite}
                                    onChange={(e) => handleInputChange('clientWebsite', e.target.value)}
                                />
                            </div>
                            
                            {/* Fixed Cloud Quote Management */}
                            <div className="bg-gradient-to-br from-blue-600 to-indigo-500 rounded-xl text-white p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Database className="w-6 h-6" />
                                    ‚òÅÔ∏è Fixed Cloud Quote Management
                                </h2>
                                
                                <div className="grid md:grid-cols-2 gap-4 mb-4">
                                    <div className="bg-white/10 rounded-lg p-4">
                                        <h3 className="font-semibold mb-3">üì• Load Quote</h3>
                                        <div className="flex gap-2 mb-2">
                                            <input 
                                                type="text"
                                                placeholder="Enter code (e.g., MICROSOFT-JUN13)"
                                                value={templateCode}
                                                onChange={(e) => setTemplateCode(e.target.value)}
                                                className="flex-1 p-2 text-gray-900 rounded focus:ring-2 focus:ring-white"
                                                disabled={loading}
                                            />
                                            <button
                                                onClick={loadQuote}
                                                disabled={loading}
                                                className="px-4 py-2 bg-white text-blue-600 font-semibold rounded hover:bg-gray-50 transition-colors disabled:opacity-50"
                                            >
                                                {loading ? 'üîÑ' : 'üì• LOAD'}
                                            </button>
                                        </div>
                                        <div className="text-xs text-white/70">
                                            <strong>Session codes:</strong> {cloudStorage.getAllCodes().slice(0, 3).join(', ')}{cloudStorage.getAllCodes().length > 3 ? '...' : ''}
                                            {cloudStorage.getAllCodes().length === 0 && 'None in current session'}
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white/10 rounded-lg p-4">
                                        <h3 className="font-semibold mb-3">‚òÅÔ∏è Save to Cloud</h3>
                                        <button
                                            onClick={saveQuote}
                                            disabled={loading || !formData.prospectName}
                                            className="w-full bg-white text-blue-600 font-semibold py-2 px-4 rounded hover:bg-gray-50 transition-colors disabled:opacity-50 mb-2"
                                        >
                                            {loading ? 'üîÑ Saving to Cloud...' : '‚òÅÔ∏è SAVE TO SUPABASE'}
                                        </button>
                                        {!formData.prospectName && (
                                            <p className="text-white/80 text-sm">‚ö†Ô∏è Enter prospect name to enable saving</p>
                                        )}
                                        {formData.prospectName && (
                                            <p className="text-white/80 text-sm">‚úÖ Ready to save as: <strong>{generateCode()}</strong></p>
                                        )}
                                    </div>
                                </div>

                                {(message || cloudStatus) && (
                                    <div className="space-y-2">
                                        {message && (
                                            <div className="bg-white/20 rounded-lg p-3 border-l-4 border-white">
                                                <p className="text-white font-medium">{message}</p>
                                            </div>
                                        )}
                                        {cloudStatus && (
                                            <div className="bg-white/10 rounded-lg p-2">
                                                <p className="text-white/90 text-sm">{cloudStatus}</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Tab Navigation */}
                            <div className="flex bg-gray-100 rounded-lg p-1 mb-6">
                                <button
                                    onClick={() => setActiveTab('main')}
                                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-md transition-all font-medium ${
                                        activeTab === 'main' 
                                            ? 'bg-white text-purple-900 shadow-md' 
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                >
                                    <Calculator className="w-5 h-5" />
                                    Calculator
                                </button>
                                <button
                                    onClick={() => setActiveTab('qualification')}
                                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-md transition-all font-medium ${
                                        activeTab === 'qualification' 
                                            ? 'bg-white text-purple-900 shadow-md' 
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                >
                                    <Users className="w-5 h-5" />
                                    Customer Info
                                </button>
                                <button
                                    onClick={() => setActiveTab('pricing')}
                                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-md transition-all font-medium ${
                                        activeTab === 'pricing' 
                                            ? 'bg-white text-purple-900 shadow-md' 
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                >
                                    <FileText className="w-5 h-5" />
                                    Pricing
                                </button>
                                <button
                                    onClick={() => setActiveTab('settings')}
                                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-md transition-all font-medium ${
                                        activeTab === 'settings' 
                                            ? 'bg-white text-purple-900 shadow-md' 
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                >
                                    <Settings className="w-5 h-5" />
                                    Settings
                                </button>
                            </div>

                            {/* Tab Content */}
                            {activeTab === 'main' && (
                                <div>
                                    {/* Workspace Configuration */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                        <div className="flex items-center gap-3 mb-6">
                                            <Database className="w-6 h-6 text-pink-500" />
                                            <h2 className="text-xl font-semibold text-gray-800">Workspace Configuration</h2>
                                        </div>
                                        
                                        <div className="grid md:grid-cols-3 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">BI Workspaces</label>
                                                <input 
                                                    type="number"
                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                    value={formData.biWorkspaces}
                                                    onChange={(e) => handleInputChange('biWorkspaces', e.target.value)}
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">AI Workspaces</label>
                                                <input 
                                                    type="number"
                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                    value={formData.aiWorkspaces}
                                                    onChange={(e) => handleInputChange('aiWorkspaces', e.target.value)}
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">LLM Provider</label>
                                                <select 
                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                    value={formData.llmProvider}
                                                    onChange={(e) => handleInputChange('llmProvider', e.target.value)}
                                                >
                                                    <option value="">Select Provider</option>
                                                    <option value="Customer">Customer</option>
                                                    <option value="GoodData">GoodData</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        {formData.llmProvider && (
                                            <div className="mt-4">
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Package Size</label>
                                                <select 
                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                    value={formData.package}
                                                    onChange={(e) => handleInputChange('package', e.target.value)}
                                                >
                                                    <option value="">Select Package</option>
                                                    <option value="Small">Small</option>
                                                    <option value="Medium">Medium</option>
                                                    <option value="Large">Large</option>
                                                </select>
                                            </div>
                                        )}
                                    </div>

                                    {/* Total Display */}
                                    <div className="bg-gradient-to-r from-purple-900 to-pink-500 text-white rounded-xl p-8 text-center">
                                        <h2 className="text-2xl font-semibold mb-4">üí∞ Total Annual Contract Value</h2>
                                        <div className="text-5xl font-bold mb-2">
                                            ${calculateTotal().toLocaleString()}
                                        </div>
                                        <div className="text-lg opacity-90">
                                            Monthly: ${(calculateTotal()/12).toLocaleString()}
                                        </div>
                                        <div className="mt-4 text-sm bg-white/20 rounded-lg p-3">
                                            <strong>üîß Database Connection Fixed!</strong><br/>
                                            No more localStorage errors - pure cloud storage working!
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Customer Qualification Content */}
                            {activeTab === 'qualification' && (
                                <div className="space-y-6">
                                    
                                    {/* Customer Profile Section */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                        <div className="flex items-center gap-3 mb-6">
                                            <Building className="w-6 h-6 text-purple-900" />
                                            <h2 className="text-xl font-semibold text-gray-800">Customer Profile</h2>
                                        </div>
                                        
                                        <div className="space-y-6">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Annual Revenue (USD)</label>
                                                <select 
                                                    className="w-full p-4 text-lg border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    value={formData.annualRevenue}
                                                    onChange={(e) => handleInputChange('annualRevenue', e.target.value)}
                                                >
                                                    <option value="">Select Revenue Range</option>
                                                    <option value="< 10M">&lt; $10M</option>
                                                    <option value="10M - 50M">$10M - $50M</option>
                                                    <option value="50M - 100M">$50M - $100M</option>
                                                    <option value="100M - 500M">$100M - $500M</option>
                                                    <option value="500M+">$500M+</option>
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Budget Range</label>
                                                <input 
                                                    className="w-full p-4 text-lg border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="e.g. $50K-100K annually"
                                                    value={formData.budget}
                                                    onChange={(e) => handleInputChange('budget', e.target.value)}
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">What are they looking to achieve with GoodData?</label>
                                                <textarea 
                                                    className="w-full p-4 text-lg border border-gray-300 rounded-lg bg-gray-50 resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="Describe their goals, objectives, and expected outcomes..."
                                                    value={formData.objectives}
                                                    onChange={(e) => handleInputChange('objectives', e.target.value)}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* Professional Services Section */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                        <div className="flex items-center gap-3 mb-6">
                                            <Users className="w-6 h-6 text-blue-600" />
                                            <h2 className="text-xl font-semibold text-gray-800">Professional Services</h2>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Service Level</label>
                                            <select 
                                                className="w-full p-4 text-lg border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                value={formData.professionalServices}
                                                onChange={(e) => handleInputChange('professionalServices', e.target.value)}
                                            >
                                                <option value="">Select Service Level</option>
                                                <option value="Advisory">Advisory Package - 80 hours - $10,000</option>
                                                <option value="Analytics">Analytics Package - 300 hours - $37,500</option>
                                                <option value="End-to-end">End-to-end Implementation - 800 hours - $100,000</option>
                                            </select>
                                        </div>
                                    </div>

                                    {/* Premium Enterprise Features */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                        <h2 className="text-xl font-semibold text-gray-800 mb-6">Premium Enterprise Features</h2>
                                        
                                        <div className="grid md:grid-cols-2 gap-4">
                                            {[
                                                { 
                                                    key: 'additionalEnvironments', 
                                                    label: 'Additional Environments', 
                                                    desc: 'Dev/Test/Staging environments', 
                                                    price: pricing.additionalEnvironments 
                                                },
                                                { 
                                                    key: 'samlOidc', 
                                                    label: 'SAML & Multiple OIDC', 
                                                    desc: 'Enterprise SSO integration', 
                                                    price: pricing.samlOidc 
                                                },
                                                { 
                                                    key: 'dataCenterRegions', 
                                                    label: 'Data Center Regions', 
                                                    desc: 'Multi-region deployment', 
                                                    price: pricing.dataCenterRegions 
                                                },
                                                { 
                                                    key: 'usageAnalytics', 
                                                    label: 'Usage Analytics', 
                                                    desc: 'Advanced usage reporting', 
                                                    price: pricing.usageAnalytics 
                                                },
                                                { 
                                                    key: 'auditLog', 
                                                    label: 'Audit Log', 
                                                    desc: 'Comprehensive audit trails', 
                                                    price: pricing.auditLog 
                                                },
                                                { 
                                                    key: 'hipaaCompliance', 
                                                    label: 'HIPAA Compliance', 
                                                    desc: 'Healthcare data protection', 
                                                    price: pricing.hipaaCompliance 
                                                }
                                            ].map(addon => (
                                                <label key={addon.key} className="flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                                                    <input 
                                                        type="checkbox"
                                                        checked={formData[addon.key]}
                                                        onChange={(e) => handleInputChange(addon.key, e.target.checked)}
                                                        className="w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 mt-0.5"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="flex items-center justify-between mb-1">
                                                            <span className="text-gray-800 font-medium">{addon.label}</span>
                                                            <span className="text-purple-600 font-semibold">${addon.price.toLocaleString()}</span>
                                                        </div>
                                                        <p className="text-sm text-gray-600">{addon.desc}</p>
                                                    </div>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Comments Section */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                        <h2 className="text-xl font-semibold text-gray-800 mb-6">Internal Notes & Comments</h2>
                                        <div className="grid md:grid-cols-2 gap-6">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">AE Comments</label>
                                                <textarea 
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="Account Executive notes..."
                                                    value={formData.aeComments}
                                                    onChange={(e) => handleInputChange('aeComments', e.target.value)}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Finance Comments</label>
                                                <textarea 
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="Finance notes..."
                                                    value={formData.financeComments}
                                                    onChange={(e) => handleInputChange('financeComments', e.target.value)}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Clean Pricing Display */}
                            {activeTab === 'pricing' && (
                                <div className="space-y-6">
                                    
                                    {/* Header with Total */}
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-3">
                                                <DollarSign className="w-8 h-8 text-green-600" />
                                                Professional Pricing Breakdown
                                            </h2>
                                            <p className="text-gray-600 mt-1">Annual subscription pricing with detailed cost analysis</p>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-sm text-gray-600">Total Annual Contract Value</div>
                                            <div className="text-4xl font-bold text-purple-900">
                                                ${calculateTotal().toLocaleString()}
                                            </div>
                                            <div className="text-gray-600">
                                                ${(calculateTotal()/12).toLocaleString()}/month
                                            </div>
                                        </div>
                                    </div>

                                    {/* Platform Components */}
                                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                        <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                            <Database className="w-5 h-5 text-blue-600" />
                                            Platform Components
                                        </h3>
                                        
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center py-3 border-b border-gray-100">
                                                <div>
                                                    <span className="font-medium text-lg">Platform Base Fee</span>
                                                    <p className="text-sm text-gray-600">Core platform access and infrastructure</p>
                                                </div>
                                                <span className="text-xl font-bold text-blue-600">${getPlatformCosts().platformFee.toLocaleString()}</span>
                                            </div>
                                            
                                            {formData.biWorkspaces && (
                                                <div className="flex justify-between items-center py-3 border-b border-gray-100">
                                                    <div>
                                                        <span className="font-medium text-lg">BI Workspaces</span>
                                                        <p className="text-sm text-gray-600">{formData.biWorkspaces} workspaces √ó ${pricing.biWorkspacePrice}/month √ó 12 months</p>
                                                    </div>
                                                    <span className="text-xl font-bold text-blue-600">${getPlatformCosts().biWorkspaces.toLocaleString()}</span>
                                                </div>
                                            )}
                                            
                                            {formData.aiWorkspaces && (
                                                <div className="flex justify-between items-center py-3 border-b border-gray-100">
                                                    <div>
                                                        <span className="font-medium text-lg">AI Workspaces</span>
                                                        <p className="text-sm text-gray-600">{formData.aiWorkspaces} workspaces √ó ${pricing.aiWorkspacePrice}/month √ó 12 months</p>
                                                    </div>
                                                    <span className="text-xl font-bold text-blue-600">${getPlatformCosts().aiWorkspaces.toLocaleString()}</span>
                                                </div>
                                            )}

                                            {formData.llmProvider && formData.package && (
                                                <div className="flex justify-between items-center py-3 border-b border-gray-100">
                                                    <div>
                                                        <span className="font-medium text-lg">LLM Package - {formData.llmProvider} {formData.package}</span>
                                                        <p className="text-sm text-gray-600">${pricing.llmPackages[formData.llmProvider]?.[formData.package] || 0}/month √ó 12 months</p>
                                                    </div>
                                                    <span className="text-xl font-bold text-blue-600">${getPlatformCosts().llmPackage.toLocaleString()}</span>
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="mt-4 pt-4 border-t border-gray-200">
                                            <div className="flex justify-between items-center text-lg font-semibold">
                                                <span>Platform Subtotal</span>
                                                <span className="text-blue-600">
                                                    ${(getPlatformCosts().platformFee + getPlatformCosts().biWorkspaces + getPlatformCosts().aiWorkspaces + getPlatformCosts().llmPackage).toLocaleString()}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Professional Services */}
                                    {formData.professionalServices && (
                                        <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                                <Users className="w-5 h-5 text-green-600" />
                                                Professional Services
                                            </h3>
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <span className="font-medium text-lg">{formData.professionalServices} Package</span>
                                                    <p className="text-sm text-gray-600">
                                                        {formData.professionalServices === 'Advisory' && 'Strategic guidance and best practices (80 hours)'}
                                                        {formData.professionalServices === 'Analytics' && 'Analytics implementation and optimization (300 hours)'}
                                                        {formData.professionalServices === 'End-to-end' && 'Complete implementation and deployment (800 hours)'}
                                                    </p>
                                                </div>
                                                <span className="text-xl font-bold text-green-600">
                                                    ${getProfessionalServicesCost().toLocaleString()}
                                                </span>
                                            </div>
                                        </div>
                                    )}

                                    {/* Premium Features */}
                                    {getPremiumFeaturesCost() > 0 && (
                                        <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                                <Settings className="w-5 h-5 text-purple-600" />
                                                Premium Enterprise Features
                                            </h3>
                                            <div className="space-y-3">
                                                {[
                                                    { key: 'additionalEnvironments', label: 'Additional Environments', price: pricing.additionalEnvironments },
                                                    { key: 'samlOidc', label: 'SAML & Multiple OIDC', price: pricing.samlOidc },
                                                    { key: 'dataCenterRegions', label: 'Data Center Regions', price: pricing.dataCenterRegions },
                                                    { key: 'usageAnalytics', label: 'Usage Analytics', price: pricing.usageAnalytics },
                                                    { key: 'auditLog', label: 'Audit Log', price: pricing.auditLog },
                                                    { key: 'hipaaCompliance', label: 'HIPAA Compliance', price: pricing.hipaaCompliance }
                                                ].filter(addon => formData[addon.key]).map(addon => (
                                                    <div key={addon.key} className="flex justify-between items-center py-2 border-b border-gray-100">
                                                        <span className="font-medium">{addon.label}</span>
                                                        <span className="text-lg font-bold text-purple-600">${addon.price.toLocaleString()}</span>
                                                    </div>
                                                ))}
                                            </div>
                                            
                                            <div className="mt-4 pt-4 border-t border-gray-200">
                                                <div className="flex justify-between items-center text-lg font-semibold">
                                                    <span>Premium Features Subtotal</span>
                                                    <span className="text-purple-600">
                                                        ${getPremiumFeaturesCost().toLocaleString()}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Final Total */}
                                    <div className="bg-gradient-to-r from-purple-900 to-pink-500 text-white rounded-xl p-8">
                                        <div className="flex justify-between items-center text-2xl font-bold mb-6">
                                            <div>üí∞ Total Annual Contract Value</div>
                                            <div>${calculateTotal().toLocaleString()}</div>
                                        </div>
                                        <div className="grid md:grid-cols-4 gap-4 text-center">
                                            <div className="bg-white/20 rounded-lg p-4">
                                                <div className="text-sm opacity-90">Monthly Equivalent</div>
                                                <div className="text-xl font-bold">${(calculateTotal()/12).toLocaleString()}</div>
                                            </div>
                                            <div className="bg-white/20 rounded-lg p-4">
                                                <div className="text-sm opacity-90">Quarterly Payment</div>
                                                <div className="text-xl font-bold">${(calculateTotal()/4).toLocaleString()}</div>
                                            </div>
                                            <div className="bg-white/20 rounded-lg p-4">
                                                <div className="text-sm opacity-90">Platform Annual</div>
                                                <div className="text-xl font-bold">${(getPlatformCosts().platformFee + getPlatformCosts().biWorkspaces + getPlatformCosts().aiWorkspaces + getPlatformCosts().llmPackage).toLocaleString()}</div>
                                            </div>
                                            <div className="bg-white/20 rounded-lg p-4">
                                                <div className="text-sm opacity-90">Services + Features</div>
                                                <div className="text-xl font-bold">${(getProfessionalServicesCost() + getPremiumFeaturesCost()).toLocaleString()}</div>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-6 text-sm bg-white/20 rounded-lg p-4 text-center">
                                            <strong>üîß Database Fixed & Working!</strong><br/>
                                            Cloud storage active - quotes save and load perfectly across devices!
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Settings tab */}
                            {activeTab === 'settings' && (
                                <div className="bg-gray-50 rounded-xl p-8 text-center">
                                    <Settings className="w-16 h-16 mx-auto text-gray-400 mb-4" />
                                    <h3 className="text-xl font-semibold text-gray-800 mb-2">Advanced Settings</h3>
                                    <p className="text-gray-600">‚öôÔ∏è Future enhancements can be added here!</p>
                                    <div className="mt-4 text-sm text-green-600 bg-green-50 rounded-lg p-3">
                                        <strong>üîß Cloud Connection Fixed!</strong><br/>
                                        Database issues resolved - calculator ready for production use.
                                    </div>
                                    <div className="mt-4 text-sm text-blue-600 bg-blue-50 rounded-lg p-3">
                                        <strong>Technical Note:</strong><br/>
                                        Removed localStorage (not supported in Claude.ai) - now using pure Supabase cloud storage.
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<GoodDataCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
