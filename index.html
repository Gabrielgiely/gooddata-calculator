<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoodData Calculator</title>
    <style>
        /* Security overlay styles */
        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .security-form {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
        }
        
        .security-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .security-subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        .form-button {
            width: 100%;
            background: #8b5cf6;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .form-button:hover {
            background: #7c3aed;
        }
        
        .form-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .calculator-content {
            display: none;
        }
        
        .calculator-content.authenticated {
            display: block;
        }
        
        .watermark {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
    
    <!-- React and other scripts for your calculator -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 1em; height: 1em; stroke: currentColor; stroke-width: 2; fill: none; }
    </style>
</head>
<body>
    <!-- Security Configuration - CHANGE THESE SETTINGS! -->
    <script>
        const SECURITY_CONFIG = {
            password: "GoodData2025!",
            allowedDomains: ["gooddata.com", "yourcompany.com"],
            sessionTimeout: 4 * 60 * 60 * 1000, // 4 hours
            showWatermark: true
        };
    </script>

    <!-- Security Overlay (the lock on your door) -->
    <div id="securityOverlay" class="security-overlay">
        <div class="security-form">
            <!-- Step 1: Password -->
            <div id="passwordStep">
                <div class="security-title">üîí Secure Access</div>
                <div class="security-subtitle">This calculator contains confidential pricing information</div>
                
                <div class="form-group">
                    <label class="form-label">Access Password</label>
                    <input type="password" id="passwordInput" class="form-input" placeholder="Enter password">
                </div>
                
                <button onclick="validatePassword()" class="form-button">Access Calculator</button>
                <div id="passwordError" class="error-message hidden"></div>
            </div>
            
            <!-- Step 2: Email Verification -->
            <div id="emailStep" class="hidden">
                <div class="security-title">‚úÖ Email Verification</div>
                <div class="security-subtitle">Please verify your company email address</div>
                
                <div class="form-group">
                    <label class="form-label">Company Email</label>
                    <input type="email" id="emailInput" class="form-input" placeholder="your.email@company.com" autofocus>
                    <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                        Allowed domains: gooddata.com, yourcompany.com
                    </div>
                </div>
                
                <button onclick="validateEmail()" class="form-button">Continue to Calculator</button>
                <div id="emailError" class="error-message hidden"></div>
            </div>
        </div>
    </div>

    <!-- Watermark -->
    <div id="watermark" class="watermark hidden">
        üîí CONFIDENTIAL - GoodData Internal Use Only
    </div>

    <!-- Your Original Calculator (hidden until authenticated) -->
    <div id="calculatorContent" class="calculator-content">
        <div id="root"></div>

        <script type="text/babel">
            const { useState } = React;
            const { createRoot } = ReactDOM;

            const Calculator = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <rect width="16" height="20" x="4" y="2" rx="2"/>
                    <line x1="8" x2="16" y1="6" y2="6"/>
                </svg>
            );

            const Database = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <ellipse cx="12" cy="5" rx="9" ry="3"/>
                    <path d="m3 5v14c0 3 4 3 9 3s9 0 9-3V5"/>
                </svg>
            );

            const Users = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                </svg>
            );

            const Building = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/>
                    <path d="M6 12h4"/>
                </svg>
            );

            const DollarSign = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="12" x2="12" y1="2" y2="22"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
            );

            const Globe = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="m12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
                </svg>
            );

            const Settings = () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
            );

            class SupabaseStorage {
                constructor() {
                    this.supabaseUrl = 'https://ysaxvpcwlmxdbietmjrl.supabase.co';
                    this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzYXh2cGN3bG14ZGJpZXRtanJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NzQwOTYsImV4cCI6MjA2NTI1MDA5Nn0.SnjvZx-xVMwtPBe62xY66y6vi1CQq4F04AOy53oRPDE';
                    this.quotes = new Map();
                    this.isProduction = window.location.hostname !== 'claude.ai';
                }

                async save(code, data) {
                    this.quotes.set(code, { data, timestamp: new Date().toISOString() });
                    if (this.isProduction) {
                        try {
                            const response = await fetch(`${this.supabaseUrl}/rest/v1/Quotes`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'apikey': this.supabaseKey,
                                    'Authorization': `Bearer ${this.supabaseKey}`
                                },
                                body: JSON.stringify({ code, data, created_at: new Date().toISOString() })
                            });
                            return { success: response.ok, code, cloudSaved: response.ok };
                        } catch (error) {
                            return { success: false, code, error: error.message };
                        }
                    }
                    return { success: true, code, cloudSaved: false };
                }

                async load(code) {
                    if (this.quotes.has(code)) {
                        const quoteData = this.quotes.get(code);
                        return { success: true, data: quoteData.data, code };
                    }
                    
                    if (this.isProduction) {
                        try {
                            const response = await fetch(`${this.supabaseUrl}/rest/v1/Quotes?code=eq.${code}`, {
                                headers: {
                                    'apikey': this.supabaseKey,
                                    'Authorization': `Bearer ${this.supabaseKey}`
                                }
                            });
                            const quotes = await response.json();
                            if (quotes && quotes.length > 0) {
                                return { success: true, data: quotes[0].data, code };
                            }
                        } catch (error) {
                            return { success: false, error: error.message, code };
                        }
                    }
                    return { success: false, error: 'Quote not found', code };
                }

                async getRecentQuotes(limit = 10) {
                    const fallbackQuotes = Array.from(this.quotes.entries()).map(([code, quote]) => ({
                        code,
                        data: quote.data,
                        created_at: quote.timestamp
                    })).sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).slice(0, limit);

                    if (this.isProduction) {
                        try {
                            const response = await fetch(`${this.supabaseUrl}/rest/v1/Quotes?order=created_at.desc&limit=${limit}`, {
                                headers: {
                                    'apikey': this.supabaseKey,
                                    'Authorization': `Bearer ${this.supabaseKey}`
                                }
                            });
                            const quotes = await response.json();
                            return { success: true, quotes: quotes || [] };
                        } catch (error) {
                            return { success: false, error: error.message, quotes: fallbackQuotes };
                        }
                    }
                    return { success: true, quotes: fallbackQuotes };
                }

                async searchQuotes(searchTerm) {
                    const fallbackQuotes = Array.from(this.quotes.entries())
                        .filter(([code, quote]) => 
                            code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (quote.data.prospectName && quote.data.prospectName.toLowerCase().includes(searchTerm.toLowerCase()))
                        )
                        .map(([code, quote]) => ({
                            code,
                            data: quote.data,
                            created_at: quote.timestamp
                        }))
                        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

                    if (this.isProduction) {
                        try {
                            const response = await fetch(`${this.supabaseUrl}/rest/v1/Quotes?or=(code.ilike.*${searchTerm}*,data->>prospectName.ilike.*${searchTerm}*)&order=created_at.desc`, {
                                headers: {
                                    'apikey': this.supabaseKey,
                                    'Authorization': `Bearer ${this.supabaseKey}`
                                }
                            });
                            const quotes = await response.json();
                            return { success: true, quotes: quotes || [] };
                        } catch (error) {
                            return { success: false, error: error.message, quotes: fallbackQuotes };
                        }
                    }
                    return { success: true, quotes: fallbackQuotes };
                }

                async getAllQuotes() {
                    const fallbackQuotes = Array.from(this.quotes.entries()).map(([code, quote]) => ({
                        code,
                        data: quote.data,
                        created_at: quote.timestamp
                    })).sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

                    if (this.isProduction) {
                        try {
                            const response = await fetch(`${this.supabaseUrl}/rest/v1/Quotes?order=created_at.desc`, {
                                headers: {
                                    'apikey': this.supabaseKey,
                                    'Authorization': `Bearer ${this.supabaseKey}`
                                }
                            });
                            const quotes = await response.json();
                            return { success: true, quotes: quotes || [] };
                        } catch (error) {
                            return { success: false, error: error.message, quotes: fallbackQuotes };
                        }
                    }
                    return { success: true, quotes: fallbackQuotes };
                }
            }

            const cloudStorage = new SupabaseStorage();

            function GoodDataCalculator() {
                const [templateCode, setTemplateCode] = useState('');
                const [message, setMessage] = useState('');
                const [loading, setLoading] = useState(false);
                const [editMode, setEditMode] = useState(false);
                const [showConfirmModal, setShowConfirmModal] = useState(false);
                const [showSuccessModal, setShowSuccessModal] = useState(false);
                const [showRecentQuotes, setShowRecentQuotes] = useState(false);
                const [recentQuotes, setRecentQuotes] = useState([]);
                const [quotesLoading, setQuotesLoading] = useState(false);
                const [searchTerm, setSearchTerm] = useState('');
                const [savedQuoteCode, setSavedQuoteCode] = useState('');
                
                const [formData, setFormData] = useState({
                    prospectName: '',
                    clientWebsite: '',
                    annualRevenue: '',
                    numberOfEmployees: '',
                    objectives: '',
                    usageScope: '',
                    monetization: '',
                    growthOpportunity: '',
                    license: '',
                    totalWorkspaces: '',
                    biWorkspaces: '',
                    aiWorkspaces: '',
                    llmProvider: '',
                    package: '',
                    professionalServices: '',
                    additionalEnvironments: false,
                    samlOidc: false,
                    dataCenterRegions: false,
                    usageAnalytics: false,
                    auditLog: false,
                    hipaaCompliance: false
                });

                const [pricing, setPricing] = useState({
                    platformFee: 36000,
                    professionalLicense: 24000,
                    enterpriseLicense: 36000,
                    biWorkspacePrice: 25,
                    aiWorkspacePrice: 10,
                    advisory: 10000,
                    analytics: 37500,
                    endToEnd: 100000,
                    additionalEnvironments: 12000,
                    samlOidc: 3000,
                    dataCenterRegions: 5000,
                    usageAnalytics: 2500,
                    auditLog: 3000,
                    hipaaCompliance: 8000,
                    llmPackages: {
                        'Customer': { 'Small': 100, 'Medium': 430, 'Large': 750 },
                        'GoodData': { 'Small': 200, 'Medium': 750, 'Large': 900 }
                    }
                });

                const updatePricing = (field, value) => {
                    setPricing(prev => ({ ...prev, [field]: parseInt(value) || 0 }));
                };

                const updateLLMPricing = (provider, size, value) => {
                    setPricing(prev => ({
                        ...prev,
                        llmPackages: {
                            ...prev.llmPackages,
                            [provider]: {
                                ...prev.llmPackages[provider],
                                [size]: parseInt(value) || 0
                            }
                        }
                    }));
                };

                const handleInputChange = (field, value) => {
                    setFormData(prev => {
                        const newData = { ...prev, [field]: value };
                        if (field === 'totalWorkspaces') {
                            newData.biWorkspaces = value;
                        }
                        return newData;
                    });
                };

                const calculateTotal = () => {
                    const bi = parseInt(formData.biWorkspaces) || 0;
                    const ai = parseInt(formData.aiWorkspaces) || 0;
                    
                    // Use license fee instead of platform fee if license is selected
                    let baseAmount = 0;
                    if (formData.license === 'Professional') {
                        baseAmount = pricing.professionalLicense;
                    } else if (formData.license === 'Enterprise') {
                        baseAmount = pricing.enterpriseLicense;
                    } else {
                        baseAmount = pricing.platformFee; // fallback to platform fee
                    }
                    
                    let total = baseAmount + (bi * pricing.biWorkspacePrice * 12) + (ai * pricing.aiWorkspacePrice * 12);
                    
                    if (formData.llmProvider && formData.package) {
                        const monthlyCost = pricing.llmPackages[formData.llmProvider]?.[formData.package] || 0;
                        total += monthlyCost * 12;
                    }
                    
                    if (formData.professionalServices === 'Advisory') total += pricing.advisory;
                    if (formData.professionalServices === 'Analytics') total += pricing.analytics;
                    if (formData.professionalServices === 'End-to-end') total += pricing.endToEnd;
                    if (formData.additionalEnvironments) total += pricing.additionalEnvironments;
                    if (formData.samlOidc) total += pricing.samlOidc;
                    if (formData.dataCenterRegions) total += pricing.dataCenterRegions;
                    if (formData.usageAnalytics) total += pricing.usageAnalytics;
                    if (formData.auditLog) total += pricing.auditLog;
                    if (formData.hipaaCompliance) total += pricing.hipaaCompliance;
                    
                    return total;
                };

                const getProfessionalServicesCost = () => {
                    if (formData.professionalServices === 'Advisory') return pricing.advisory;
                    if (formData.professionalServices === 'Analytics') return pricing.analytics;
                    if (formData.professionalServices === 'End-to-end') return pricing.endToEnd;
                    return 0;
                };

                const generateCode = () => {
                    let companyPart = 'PROSPECT';
                    if (formData.prospectName) {
                        companyPart = formData.prospectName.replace(/[^a-zA-Z0-9]/g, '').toUpperCase().substring(0, 8);
                    }
                    const now = new Date();
                    const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
                    const month = monthNames[now.getMonth()];
                    const day = now.getDate().toString().padStart(2, '0');
                    return `${companyPart}-${month}${day}`;
                };

                const saveQuote = async () => {
                    if (!formData.prospectName) {
                        setMessage('‚ùå Please enter a prospect name');
                        setTimeout(() => setMessage(''), 3000);
                        return;
                    }

                    const code = generateCode();
                    setLoading(true);
                    setMessage('üîÑ Saving quote...');
                    
                    try {
                        const result = await cloudStorage.save(code, formData);
                        if (result.success) {
                            setSavedQuoteCode(code);
                            setShowSuccessModal(true);
                            setMessage('');
                        } else {
                            setMessage(`‚ùå Save failed: ${result.error}`);
                            setTimeout(() => setMessage(''), 5000);
                        }
                    } catch (error) {
                        setMessage('‚ùå Save failed');
                        setTimeout(() => setMessage(''), 3000);
                    }
                    setLoading(false);
                    setShowConfirmModal(false);
                };

                const handleSaveClick = () => {
                    if (!formData.prospectName) {
                        setMessage('‚ùå Please enter a prospect name');
                        setTimeout(() => setMessage(''), 3000);
                        return;
                    }
                    setShowConfirmModal(true);
                };

                const copyToClipboard = async (text) => {
                    try {
                        await navigator.clipboard.writeText(text);
                        setMessage('‚úÖ Quote code copied to clipboard!');
                        setTimeout(() => setMessage(''), 3000);
                    } catch (err) {
                        setMessage('‚ùå Failed to copy to clipboard');
                        setTimeout(() => setMessage(''), 3000);
                    }
                };

                const loadRecentQuotes = async () => {
                    setQuotesLoading(true);
                    try {
                        const result = await cloudStorage.getRecentQuotes(20);
                        if (result.success) {
                            setRecentQuotes(result.quotes);
                        } else {
                            setMessage('‚ùå Failed to load recent quotes');
                            setTimeout(() => setMessage(''), 3000);
                        }
                    } catch (error) {
                        setMessage('‚ùå Error loading quotes');
                        setTimeout(() => setMessage(''), 3000);
                    }
                    setQuotesLoading(false);
                };

                const searchQuotes = async (term) => {
                    if (!term.trim()) {
                        loadRecentQuotes();
                        return;
                    }
                    setQuotesLoading(true);
                    try {
                        const result = await cloudStorage.searchQuotes(term);
                        if (result.success) {
                            setRecentQuotes(result.quotes);
                        } else {
                            setMessage('‚ùå Search failed');
                            setTimeout(() => setMessage(''), 3000);
                        }
                    } catch (error) {
                        setMessage('‚ùå Search error');
                        setTimeout(() => setMessage(''), 3000);
                    }
                    setQuotesLoading(false);
                };

                const loadQuoteFromRecent = async (code) => {
                    setQuotesLoading(true);
                    try {
                        const result = await cloudStorage.load(code);
                        if (result.success) {
                            setFormData(result.data);
                            setShowRecentQuotes(false);
                            setMessage(`‚úÖ Quote loaded: ${code}`);
                            setTimeout(() => setMessage(''), 3000);
                        } else {
                            setMessage(`‚ùå Failed to load quote: ${code}`);
                            setTimeout(() => setMessage(''), 3000);
                        }
                    } catch (error) {
                        setMessage('‚ùå Error loading quote');
                        setTimeout(() => setMessage(''), 3000);
                    }
                    setQuotesLoading(false);
                };

                const calculateQuoteTotal = (quoteData) => {
                    const bi = parseInt(quoteData.biWorkspaces) || 0;
                    const ai = parseInt(quoteData.aiWorkspaces) || 0;
                    
                    let baseAmount = 0;
                    if (quoteData.license === 'Professional') {
                        baseAmount = pricing.professionalLicense;
                    } else if (quoteData.license === 'Enterprise') {
                        baseAmount = pricing.enterpriseLicense;
                    } else {
                        baseAmount = pricing.platformFee;
                    }
                    
                    let total = baseAmount + (bi * pricing.biWorkspacePrice * 12) + (ai * pricing.aiWorkspacePrice * 12);
                    
                    if (quoteData.llmProvider && quoteData.package) {
                        const monthlyCost = pricing.llmPackages[quoteData.llmProvider]?.[quoteData.package] || 0;
                        total += monthlyCost * 12;
                    }
                    
                    if (quoteData.professionalServices === 'Advisory') total += pricing.advisory;
                    if (quoteData.professionalServices === 'Analytics') total += pricing.analytics;
                    if (quoteData.professionalServices === 'End-to-end') total += pricing.endToEnd;
                    if (quoteData.additionalEnvironments) total += pricing.additionalEnvironments;
                    if (quoteData.samlOidc) total += pricing.samlOidc;
                    if (quoteData.dataCenterRegions) total += pricing.dataCenterRegions;
                    if (quoteData.usageAnalytics) total += pricing.usageAnalytics;
                    if (quoteData.auditLog) total += pricing.auditLog;
                    if (quoteData.hipaaCompliance) total += pricing.hipaaCompliance;
                    
                    return total;
                };

                const loadQuote = async () => {
                    if (!templateCode.trim()) {
                        setMessage('‚ùå Please enter a quote code');
                        setTimeout(() => setMessage(''), 3000);
                        return;
                    }

                    setLoading(true);
                    setMessage('üîÑ Loading quote...');
                    
                    try {
                        const result = await cloudStorage.load(templateCode.toUpperCase());
                        if (result.success) {
                            setFormData(result.data);
                            setMessage(`‚úÖ Quote loaded: ${result.code}`);
                            setTemplateCode('');
                        } else {
                            setMessage(`‚ùå Quote not found: ${templateCode.toUpperCase()}`);
                        }
                        setTimeout(() => setMessage(''), 5000);
                    } catch (error) {
                        setMessage('‚ùå Load failed');
                        setTimeout(() => setMessage(''), 3000);
                    }
                    setLoading(false);
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-white to-violet-50 p-4">
                        <div className="max-w-6xl mx-auto">
                            
                            <div className="rounded-xl shadow-xl text-white p-6 mb-6 relative overflow-hidden" style={{
                                background: `linear-gradient(135deg, #1C0D3F 0%, #A93DF6 50%, #ED26B7 100%)`
                            }}>
                                <div className="absolute inset-0 opacity-20">
                                    <div className="absolute inset-0" style={{
                                        backgroundImage: `repeating-linear-gradient(
                                            45deg,
                                            transparent,
                                            transparent 10px,
                                            rgba(255, 255, 255, 0.1) 10px,
                                            rgba(255, 255, 255, 0.1) 12px
                                        )`
                                    }}></div>
                                </div>
                                <div className="relative z-10 flex items-center gap-4">
                                    <div className="bg-white/20 p-3 rounded-xl">
                                        <Globe className="w-8 h-8" />
                                    </div>
                                    <div className="flex-1">
                                        <h1 className="text-3xl font-bold mb-2">GoodData Pricing Calculator</h1>
                                        <div className="text-sm bg-white/20 rounded-lg p-3 flex items-center gap-2">
                                            üîí Professional pricing calculator - Secured Access
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl shadow-xl border border-gray-100 p-8 mb-8">
                                
                                <div className="grid md:grid-cols-2 gap-4 mb-6">
                                    <input 
                                        type="text"
                                        placeholder="Prospect/Customer Name *"
                                        className="w-full p-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                        value={formData.prospectName}
                                        onChange={(e) => handleInputChange('prospectName', e.target.value)}
                                    />
                                    <input 
                                        type="url"
                                        placeholder="Client Website"
                                        className="w-full p-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                        value={formData.clientWebsite}
                                        onChange={(e) => handleInputChange('clientWebsite', e.target.value)}
                                    />
                                </div>
                                
                                <div className="bg-gradient-to-br from-purple-600 to-pink-500 rounded-xl text-white p-6 mb-6">
                                    <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                        <Database className="w-6 h-6" />
                                        Quote Management
                                    </h2>
                                    
                                    <div className="grid md:grid-cols-3 gap-4 mb-4">
                                        <div className="bg-white/10 rounded-lg p-4">
                                            <h3 className="font-semibold mb-3">üì• Load Quote</h3>
                                            <div className="flex gap-2 mb-2">
                                                <input 
                                                    type="text"
                                                    placeholder="Enter code"
                                                    value={templateCode}
                                                    onChange={(e) => setTemplateCode(e.target.value)}
                                                    className="flex-1 p-2 text-gray-900 rounded"
                                                    disabled={loading}
                                                />
                                                <button
                                                    onClick={loadQuote}
                                                    disabled={loading}
                                                    className="px-4 py-2 bg-white text-purple-600 font-semibold rounded hover:bg-gray-50 disabled:opacity-50"
                                                >
                                                    {loading ? 'üîÑ' : 'üì• LOAD'}
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-white/10 rounded-lg p-4">
                                            <h3 className="font-semibold mb-3">‚òÅÔ∏è Save Quote</h3>
                                            <button
                                                onClick={handleSaveClick}
                                                disabled={loading || !formData.prospectName}
                                                className="w-full bg-white text-purple-600 font-semibold py-2 px-4 rounded hover:bg-gray-50 disabled:opacity-50 mb-2"
                                            >
                                                {loading ? 'üîÑ Saving...' : '‚òÅÔ∏è SAVE'}
                                            </button>
                                            {formData.prospectName && (
                                                <p className="text-white/80 text-sm">Code: <strong>{generateCode()}</strong></p>
                                            )}
                                        </div>
                                        
                                        <div className="bg-white/10 rounded-lg p-4">
                                            <h3 className="font-semibold mb-3">üìã Recent Quotes</h3>
                                            <button
                                                onClick={() => {
                                                    setShowRecentQuotes(true);
                                                    loadRecentQuotes();
                                                }}
                                                className="w-full bg-white text-purple-600 font-semibold py-2 px-4 rounded hover:bg-gray-50"
                                            >
                                                üìã VIEW RECENT
                                            </button>
                                        </div>
                                    </div>

                                    {message && (
                                        <div className="bg-white/20 rounded-lg p-3">
                                            <p className="text-white font-medium">{message}</p>
                                        </div>
                                    )}
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <Building className="w-6 h-6 text-purple-900" />
                                        <h2 className="text-xl font-semibold text-gray-800">Customer Profile</h2>
                                    </div>
                                    
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Annual Revenue (USD)</label>
                                            <select 
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                value={formData.annualRevenue}
                                                onChange={(e) => handleInputChange('annualRevenue', e.target.value)}
                                            >
                                                <option value="">Select Range</option>
                                                <option value="< 10M">&lt; $10M</option>
                                                <option value="10M - 50M">$10M - $50M</option>
                                                <option value="50M - 100M">$50M - $100M</option>
                                                <option value="100M - 500M">$100M - $500M</option>
                                                <option value="500M+">$500M+</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Number of Employees</label>
                                            <select 
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                value={formData.numberOfEmployees}
                                                onChange={(e) => handleInputChange('numberOfEmployees', e.target.value)}
                                            >
                                                <option value="">Select Range</option>
                                                <option value="<100">&lt;100</option>
                                                <option value="101-1,000">101-1,000</option>
                                                <option value="1,001-2,500">1,001-2,500</option>
                                                <option value="2,500+">2,500+</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">What are they looking to achieve with GoodData?</label>
                                            <textarea 
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none"
                                                rows="4"
                                                placeholder="Describe their goals and objectives..."
                                                value={formData.objectives}
                                                onChange={(e) => handleInputChange('objectives', e.target.value)}
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-6">Usage Plan Assessment</h2>
                                    
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-3">Usage by department or globally?</label>
                                            <div className="space-y-2">
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="usageScope"
                                                        value="Department"
                                                        checked={formData.usageScope === 'Department'}
                                                        onChange={(e) => handleInputChange('usageScope', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">Department</span>
                                                </label>
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="usageScope"
                                                        value="Globally"
                                                        checked={formData.usageScope === 'Globally'}
                                                        onChange={(e) => handleInputChange('usageScope', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">Globally</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-3">If they will monetize the product, how?</label>
                                            <div className="space-y-2">
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="monetization"
                                                        value="YES"
                                                        checked={formData.monetization === 'YES'}
                                                        onChange={(e) => handleInputChange('monetization', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">YES</span>
                                                </label>
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="monetization"
                                                        value="NO"
                                                        checked={formData.monetization === 'NO'}
                                                        onChange={(e) => handleInputChange('monetization', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">NO</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-3">Is there a significant growth opportunity here?</label>
                                            <div className="space-y-2">
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="growthOpportunity"
                                                        value="YES"
                                                        checked={formData.growthOpportunity === 'YES'}
                                                        onChange={(e) => handleInputChange('growthOpportunity', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">YES</span>
                                                </label>
                                                <label className="flex items-center">
                                                    <input 
                                                        type="radio"
                                                        name="growthOpportunity"
                                                        value="NO"
                                                        checked={formData.growthOpportunity === 'NO'}
                                                        onChange={(e) => handleInputChange('growthOpportunity', e.target.value)}
                                                        className="w-4 h-4 text-purple-600"
                                                    />
                                                    <span className="ml-2 text-gray-700">NO</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <Database className="w-6 h-6 text-pink-500" />
                                        <h2 className="text-xl font-semibold text-gray-800">Workspace Configuration</h2>
                                    </div>
                                    
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">License Type</label>
                                            <select 
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                value={formData.license}
                                                onChange={(e) => handleInputChange('license', e.target.value)}
                                            >
                                                <option value="">Select License</option>
                                                <option value="Professional">Professional - $24,000/year</option>
                                                <option value="Enterprise">Enterprise - $36,000/year</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Total Workspaces</label>
                                            <input 
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                value={formData.totalWorkspaces}
                                                onChange={(e) => handleInputChange('totalWorkspaces', e.target.value)}
                                                placeholder="Enter total number of workspaces"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">BI Workspaces</label>
                                            <input 
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                value={formData.biWorkspaces}
                                                onChange={(e) => handleInputChange('biWorkspaces', e.target.value)}
                                                placeholder="Number of BI workspaces"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">AI Workspaces</label>
                                            <input 
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                value={formData.aiWorkspaces}
                                                onChange={(e) => handleInputChange('aiWorkspaces', e.target.value)}
                                                placeholder="Number of AI workspaces"
                                            />
                                        </div>
                                        
                                        {/* Only show LLM Provider when AI workspaces are configured */}
                                        {parseInt(formData.aiWorkspaces) > 0 && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">LLM Provider</label>
                                                <select 
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                    value={formData.llmProvider}
                                                    onChange={(e) => handleInputChange('llmProvider', e.target.value)}
                                                >
                                                    <option value="">Select Provider</option>
                                                    <option value="Customer">Customer</option>
                                                    <option value="GoodData">GoodData</option>
                                                </select>
                                            </div>
                                        )}
                                        
                                        {/* Only show Package when both AI workspaces and LLM Provider are configured */}
                                        {parseInt(formData.aiWorkspaces) > 0 && formData.llmProvider && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Package</label>
                                                <select 
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                                    value={formData.package}
                                                    onChange={(e) => handleInputChange('package', e.target.value)}
                                                >
                                                    <option value="">Select Package</option>
                                                    {formData.llmProvider === 'Customer' && (
                                                        <>
                                                            <option value="Small">Small - ${pricing.llmPackages.Customer.Small}/month</option>
                                                            <option value="Medium">Medium - ${pricing.llmPackages.Customer.Medium}/month</option>
                                                            <option value="Large">Large - ${pricing.llmPackages.Customer.Large}/month</option>
                                                        </>
                                                    )}
                                                    {formData.llmProvider === 'GoodData' && (
                                                        <>
                                                            <option value="Small">Small - ${pricing.llmPackages.GoodData.Small}/month</option>
                                                            <option value="Medium">Medium - ${pricing.llmPackages.GoodData.Medium}/month</option>
                                                            <option value="Large">Large - ${pricing.llmPackages.GoodData.Large}/month</option>
                                                        </>
                                                    )}
                                                </select>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <Users className="w-6 h-6 text-blue-600" />
                                        <h2 className="text-xl font-semibold text-gray-800">Professional Services</h2>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Professional Services</label>
                                        <select 
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                                            value={formData.professionalServices}
                                            onChange={(e) => handleInputChange('professionalServices', e.target.value)}
                                        >
                                            <option value="">Select Service</option>
                                            <option value="Advisory">Advisory Package - 80 hours - ${pricing.advisory.toLocaleString()}</option>
                                            <option value="Analytics">Analytics Package - 300 hours - ${pricing.analytics.toLocaleString()}</option>
                                            <option value="End-to-end">End-to-end Package - 800 hours - ${pricing.endToEnd.toLocaleString()}</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-6">Add-ons</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="space-y-4">
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.additionalEnvironments}
                                                    onChange={(e) => handleInputChange('additionalEnvironments', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">Additional Environments - ${pricing.additionalEnvironments.toLocaleString()}</span>
                                            </label>
                                            
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.samlOidc}
                                                    onChange={(e) => handleInputChange('samlOidc', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">SAML/OIDC - ${pricing.samlOidc.toLocaleString()}</span>
                                            </label>
                                            
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.dataCenterRegions}
                                                    onChange={(e) => handleInputChange('dataCenterRegions', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">Data Center Regions - ${pricing.dataCenterRegions.toLocaleString()}</span>
                                            </label>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.usageAnalytics}
                                                    onChange={(e) => handleInputChange('usageAnalytics', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">Usage Analytics - ${pricing.usageAnalytics.toLocaleString()}</span>
                                            </label>
                                            
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.auditLog}
                                                    onChange={(e) => handleInputChange('auditLog', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">Audit Log - ${pricing.auditLog.toLocaleString()}</span>
                                            </label>
                                            
                                            <label className="flex items-center">
                                                <input 
                                                    type="checkbox"
                                                    checked={formData.hipaaCompliance}
                                                    onChange={(e) => handleInputChange('hipaaCompliance', e.target.checked)}
                                                    className="w-4 h-4 text-purple-600 rounded"
                                                />
                                                <span className="ml-2 text-gray-700">HIPAA Compliance - ${pricing.hipaaCompliance.toLocaleString()}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Pricing Editor */}
                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6">
                                    <div className="flex items-center justify-between mb-6">
                                        <div className="flex items-center gap-3">
                                            <Settings className="w-6 h-6 text-gray-600" />
                                            <h2 className="text-xl font-semibold text-gray-800">Pricing Editor</h2>
                                        </div>
                                        <button
                                            onClick={() => setEditMode(!editMode)}
                                            className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                                        >
                                            {editMode ? 'Close Editor' : 'Edit Pricing'}
                                        </button>
                                    </div>
                                    
                                    {editMode && (
                                        <div className="space-y-6">
                                            {/* Always show platform fee and license pricing if license is selected */}
                                            <div className="grid md:grid-cols-3 gap-4">
                                                {!formData.license && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">Platform Fee</label>
                                                        <input 
                                                            type="number"
                                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                                            value={pricing.platformFee}
                                                            onChange={(e) => updatePricing('platformFee', e.target.value)}
                                                        />
                                                    </div>
                                                )}
                                                {formData.license === 'Professional' && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">Professional License</label>
                                                        <input 
                                                            type="number"
                                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                                            value={pricing.professionalLicense}
                                                            onChange={(e) => updatePricing('professionalLicense', e.target.value)}
                                                        />
                                                    </div>
                                                )}
                                                {formData.license === 'Enterprise' && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">Enterprise License</label>
                                                        <input 
                                                            type="number"
                                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                                            value={pricing.enterpriseLicense}
                                                            onChange={(e) => updatePricing('enterpriseLicense', e.target.value)}
                                                        />
                                                    </div>
                                                )}
                                                {/* Only show BI workspace pricing if BI workspaces are configured */}
                                                {(parseInt(formData.biWorkspaces) > 0) && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">BI Workspace (monthly)</label>
                                                        <input 
                                                            type="number"
                                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                                            value={pricing.biWorkspacePrice}
                                                            onChange={(e) => updatePricing('biWorkspacePrice', e.target.value)}
                                                        />
                                                    </div>
                                                )}
                                                {/* Only show AI workspace pricing if AI workspaces are configured */}
                                                {(parseInt(formData.aiWorkspaces) > 0) && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">AI Workspace (monthly)</label>
                                                        <input 
                                                            type="number"
                                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                                            value={pricing.aiWorkspacePrice}
                                                            onChange={(e) => updatePricing('aiWorkspacePrice', e.target.value)}
                                                        />
                                                    </div>
                                                )}
                                            </div>

                                            {/* Only show professional services pricing if any service is selected */}
                                            {formData.professionalServices && (
                                                <div className="border-t pt-6">
                                                    <div className="grid md:grid-cols-3 gap-4">
                                                        {formData.professionalServices === 'Advisory' && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Advisory Package</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.advisory}
                                                                    onChange={(e) => updatePricing('advisory', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.professionalServices === 'Analytics' && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Analytics Package</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.analytics}
                                                                    onChange={(e) => updatePricing('analytics', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.professionalServices === 'End-to-end' && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">End-to-end Package</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.endToEnd}
                                                                    onChange={(e) => updatePricing('endToEnd', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Only show LLM pricing if provider and package are selected */}
                                            {formData.llmProvider && formData.package && (
                                                <div className="border-t pt-6">
                                                    <h3 className="text-lg font-semibold mb-4">LLM Package Pricing (Monthly)</h3>
                                                    <div className="grid md:grid-cols-1 gap-6">
                                                        <div>
                                                            <h4 className="font-medium mb-3">{formData.llmProvider} Provider - {formData.package} Package</h4>
                                                            <div className="max-w-xs">
                                                                <div className="flex gap-2">
                                                                    <label className="w-16 text-sm">{formData.package}:</label>
                                                                    <input 
                                                                        type="number"
                                                                        className="flex-1 p-2 border border-gray-300 rounded"
                                                                        value={pricing.llmPackages[formData.llmProvider]?.[formData.package] || 0}
                                                                        onChange={(e) => updateLLMPricing(formData.llmProvider, formData.package, e.target.value)}
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Only show add-on pricing for selected add-ons */}
                                            {(formData.additionalEnvironments || formData.samlOidc || formData.dataCenterRegions || 
                                              formData.usageAnalytics || formData.auditLog || formData.hipaaCompliance) && (
                                                <div className="border-t pt-6">
                                                    <h3 className="text-lg font-semibold mb-4">Add-ons</h3>
                                                    <div className="grid md:grid-cols-3 gap-4">
                                                        {formData.additionalEnvironments && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Additional Environments</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.additionalEnvironments}
                                                                    onChange={(e) => updatePricing('additionalEnvironments', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.samlOidc && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">SAML/OIDC</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.samlOidc}
                                                                    onChange={(e) => updatePricing('samlOidc', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.dataCenterRegions && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Data Center Regions</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.dataCenterRegions}
                                                                    onChange={(e) => updatePricing('dataCenterRegions', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.usageAnalytics && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Usage Analytics</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.usageAnalytics}
                                                                    onChange={(e) => updatePricing('usageAnalytics', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.auditLog && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Audit Log</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.auditLog}
                                                                    onChange={(e) => updatePricing('auditLog', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                        {formData.hipaaCompliance && (
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">HIPAA Compliance</label>
                                                                <input 
                                                                    type="number"
                                                                    className="w-full p-3 border border-gray-300 rounded-lg"
                                                                    value={pricing.hipaaCompliance}
                                                                    onChange={(e) => updatePricing('hipaaCompliance', e.target.value)}
                                                                />
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                {/* Pricing Summary */}
                                <div className="bg-gradient-to-br from-purple-600 to-pink-500 rounded-xl text-white p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <DollarSign className="w-8 h-8" />
                                        <h2 className="text-2xl font-bold">Pricing Summary</h2>
                                    </div>
                                    
                                    <div className="bg-white/10 rounded-lg p-6">
                                        <h3 className="text-lg font-semibold mb-4">Annual Breakdown</h3>
                                        <div className="space-y-2 text-sm">
                                            {formData.license === 'Professional' && (
                                                <div className="flex justify-between">
                                                    <span>Professional License:</span>
                                                    <span>${pricing.professionalLicense.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.license === 'Enterprise' && (
                                                <div className="flex justify-between">
                                                    <span>Enterprise License:</span>
                                                    <span>${pricing.enterpriseLicense.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {!formData.license && (
                                                <div className="flex justify-between">
                                                    <span>Platform Fee:</span>
                                                    <span>${pricing.platformFee.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {parseInt(formData.biWorkspaces) > 0 && (
                                                <div className="flex justify-between">
                                                    <span>BI Workspaces ({formData.biWorkspaces} √ó ${pricing.biWorkspacePrice}/mo):</span>
                                                    <span>${(parseInt(formData.biWorkspaces) * pricing.biWorkspacePrice * 12).toLocaleString()}</span>
                                                </div>
                                            )}
                                            {parseInt(formData.aiWorkspaces) > 0 && (
                                                <div className="flex justify-between">
                                                    <span>AI Workspaces ({formData.aiWorkspaces} √ó ${pricing.aiWorkspacePrice}/mo):</span>
                                                    <span>${(parseInt(formData.aiWorkspaces) * pricing.aiWorkspacePrice * 12).toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.llmProvider && formData.package && (
                                                <div className="flex justify-between">
                                                    <span>LLM Package ({formData.llmProvider} {formData.package}):</span>
                                                    <span>${(pricing.llmPackages[formData.llmProvider]?.[formData.package] * 12 || 0).toLocaleString()}</span>
                                                </div>
                                            )}
                                            {getProfessionalServicesCost() > 0 && (
                                                <div className="flex justify-between">
                                                    <span>Professional Services:</span>
                                                    <span>${getProfessionalServicesCost().toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.additionalEnvironments && (
                                                <div className="flex justify-between">
                                                    <span>Additional Environments:</span>
                                                    <span>${pricing.additionalEnvironments.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.samlOidc && (
                                                <div className="flex justify-between">
                                                    <span>SAML/OIDC:</span>
                                                    <span>${pricing.samlOidc.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.dataCenterRegions && (
                                                <div className="flex justify-between">
                                                    <span>Data Center Regions:</span>
                                                    <span>${pricing.dataCenterRegions.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.usageAnalytics && (
                                                <div className="flex justify-between">
                                                    <span>Usage Analytics:</span>
                                                    <span>${pricing.usageAnalytics.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.auditLog && (
                                                <div className="flex justify-between">
                                                    <span>Audit Log:</span>
                                                    <span>${pricing.auditLog.toLocaleString()}</span>
                                                </div>
                                            )}
                                            {formData.hipaaCompliance && (
                                                <div className="flex justify-between">
                                                    <span>HIPAA Compliance:</span>
                                                    <span>${pricing.hipaaCompliance.toLocaleString()}</span>
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="mt-6 pt-4 border-t border-white/20">
                                            <div className="text-2xl font-bold">
                                                Total: ${calculateTotal().toLocaleString()}
                                            </div>
                                            <div className="text-sm opacity-90 mb-4">
                                                Annual Contract Value
                                            </div>
                                            <button
                                                onClick={handleSaveClick}
                                                disabled={loading || !formData.prospectName}
                                                className="w-full bg-white text-purple-600 font-semibold py-3 px-6 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors"
                                            >
                                                {loading ? 'üîÑ Saving...' : 'üíæ Save Quote'}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {formData.objectives && (
                                        <div className="mt-6 bg-white/10 rounded-lg p-4">
                                            <h4 className="font-semibold mb-2">Customer Objectives:</h4>
                                            <p className="text-sm opacity-90">{formData.objectives}</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* All the original modals - Recent Quotes, Confirmation, Success */}
                            {showRecentQuotes && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden shadow-2xl">
                                        <div className="p-6 border-b border-gray-200">
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="text-xl font-semibold text-gray-900 flex items-center gap-2">
                                                    üìã Recent Quotes
                                                </h3>
                                                <button
                                                    onClick={() => setShowRecentQuotes(false)}
                                                    className="text-gray-400 hover:text-gray-600"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Search by company name or quote code..."
                                                    value={searchTerm}
                                                    onChange={(e) => {
                                                        setSearchTerm(e.target.value);
                                                        searchQuotes(e.target.value);
                                                    }}
                                                    className="flex-1 p-2 border border-gray-300 rounded-lg"
                                                />
                                                <button
                                                    onClick={loadRecentQuotes}
                                                    disabled={quotesLoading}
                                                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50"
                                                >
                                                    {quotesLoading ? 'üîÑ' : 'üîÑ Refresh'}
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div className="overflow-y-auto max-h-96 p-6">
                                            {quotesLoading ? (
                                                <div className="text-center py-8">
                                                    <div className="text-gray-500">üîÑ Loading quotes...</div>
                                                </div>
                                            ) : recentQuotes.length === 0 ? (
                                                <div className="text-center py-8">
                                                    <div className="text-gray-500">No quotes found</div>
                                                </div>
                                            ) : (
                                                <div className="space-y-3">
                                                    {recentQuotes.map((quote, index) => (
                                                        <div
                                                            key={index}
                                                            className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer"
                                                            onClick={() => loadQuoteFromRecent(quote.code)}
                                                        >
                                                            <div className="flex items-center justify-between">
                                                                <div className="flex-1">
                                                                    <div className="flex items-center gap-3 mb-2">
                                                                        <span className="font-mono font-bold text-purple-600">
                                                                            {quote.code}
                                                                        </span>
                                                                        <span className="font-semibold text-gray-900">
                                                                            {quote.data.prospectName || 'Unknown Company'}
                                                                        </span>
                                                                    </div>
                                                                    <div className="text-sm text-gray-600 space-y-1">
                                                                        <div className="flex gap-4">
                                                                            {quote.data.license && (
                                                                                <span>License: {quote.data.license}</span>
                                                                            )}
                                                                            {quote.data.biWorkspaces && (
                                                                                <span>BI: {quote.data.biWorkspaces}</span>
                                                                            )}
                                                                            {quote.data.aiWorkspaces && (
                                                                                <span>AI: {quote.data.aiWorkspaces}</span>
                                                                            )}
                                                                        </div>
                                                                        <div>
                                                                            Created: {new Date(quote.created_at).toLocaleDateString()} at {new Date(quote.created_at).toLocaleTimeString()}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div className="text-right">
                                                                    <div className="text-lg font-bold text-green-600">
                                                                        ${calculateQuoteTotal(quote.data).toLocaleString()}
                                                                    </div>
                                                                    <div className="text-sm text-gray-500">
                                                                        Annual Value
                                                                    </div>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            loadQuoteFromRecent(quote.code);
                                                                        }}
                                                                        className="mt-2 px-3 py-1 bg-purple-100 text-purple-700 rounded text-sm hover:bg-purple-200"
                                                                    >
                                                                        Load Quote
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Confirmation Modal */}
                            {showConfirmModal && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                                        <div className="text-center">
                                            <div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-purple-100 mb-4">
                                                <Database className="h-6 w-6 text-purple-600" />
                                            </div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-2">
                                                Save Quote Confirmation
                                            </h3>
                                            <p className="text-sm text-gray-500 mb-6">
                                                Are you sure you want to save this quote for <strong>{formData.prospectName}</strong>?
                                                <br />
                                                Quote code will be: <strong>{generateCode()}</strong>
                                            </p>
                                            <div className="flex gap-3">
                                                <button
                                                    onClick={() => setShowConfirmModal(false)}
                                                    className="flex-1 bg-gray-100 text-gray-900 px-4 py-2 rounded-lg font-medium hover:bg-gray-200"
                                                >
                                                    Cancel
                                                </button>
                                                <button
                                                    onClick={saveQuote}
                                                    disabled={loading}
                                                    className="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 disabled:opacity-50"
                                                >
                                                    {loading ? 'Saving...' : 'Yes, Save'}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Success Modal */}
                            {showSuccessModal && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                                        <div className="text-center">
                                            <div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                                                <svg className="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                            </div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-2">
                                                üéâ Quote Saved Successfully!
                                            </h3>
                                            <div className="bg-gray-50 rounded-lg p-4 mb-4">
                                                <p className="text-sm text-gray-600 mb-2">Quote Code:</p>
                                                <p className="text-xl font-bold text-purple-600 mb-3">{savedQuoteCode}</p>
                                                <p className="text-sm text-gray-500 mb-3">
                                                    Company: {formData.prospectName}<br />
                                                    Total: ${calculateTotal().toLocaleString()}<br />
                                                    Saved: {new Date().toLocaleString()}
                                                </p>
                                            </div>
                                            <div className="flex gap-3 mb-4">
                                                <button
                                                    onClick={() => copyToClipboard(savedQuoteCode)}
                                                    className="flex-1 bg-purple-100 text-purple-700 px-4 py-2 rounded-lg font-medium hover:bg-purple-200 flex items-center justify-center gap-2"
                                                >
                                                    üìã Copy Code
                                                </button>
                                                <button
                                                    onClick={() => copyToClipboard(`Quote ${savedQuoteCode}: ${formData.prospectName} - ${calculateTotal().toLocaleString()}`)}
                                                    className="flex-1 bg-blue-100 text-blue-700 px-4 py-2 rounded-lg font-medium hover:bg-blue-200 flex items-center justify-center gap-2"
                                                >
                                                    üìÑ Copy Summary
                                                </button>
                                            </div>
                                            <button
                                                onClick={() => setShowSuccessModal(false)}
                                                className="w-full bg-gray-100 text-gray-900 px-4 py-2 rounded-lg font-medium hover:bg-gray-200"
                                            >
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            const root = createRoot(document.getElementById('root'));
            root.render(<GoodDataCalculator />);
        </script>
    </div>

    <!-- Security Logic -->
    <script>
        // Session management
        function getSession() {
            try {
                const session = localStorage.getItem('gooddata_session');
                if (!session) return null;
                
                const sessionData = JSON.parse(session);
                const now = Date.now();
                
                // Check if session expired
                if (now - sessionData.timestamp > SECURITY_CONFIG.sessionTimeout) {
                    localStorage.removeItem('gooddata_session');
                    return null;
                }
                
                return sessionData;
            } catch (e) {
                return null;
            }
        }
        
        function setSession(userData) {
            const sessionData = {
                timestamp: Date.now(),
                user: userData
            };
            try {
                localStorage.setItem('gooddata_session', JSON.stringify(sessionData));
            } catch (e) {
                console.warn('Session storage failed');
            }
        }
        
        // Password validation
        function validatePassword() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (password !== SECURITY_CONFIG.password) {
                errorDiv.textContent = 'Invalid password. Access denied.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            errorDiv.classList.add('hidden');
            document.getElementById('passwordStep').classList.add('hidden');
            document.getElementById('emailStep').classList.remove('hidden');
        }
        
        // Email validation
        function validateEmail() {
            const email = document.getElementById('emailInput').value;
            const errorDiv = document.getElementById('emailError');
            
            if (!email.trim()) {
                errorDiv.textContent = 'Please enter your email address.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            const domain = email.split('@')[1]?.toLowerCase();
            const isValidDomain = SECURITY_CONFIG.allowedDomains.some(d => d.toLowerCase() === domain);
            
            if (!isValidDomain) {
                errorDiv.textContent = 'Please use your company email address.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Success - grant access
            setSession({ email });
            grantAccess();
        }
        
        // Grant access to calculator
        function grantAccess() {
            document.getElementById('securityOverlay').classList.add('hidden');
            document.getElementById('calculatorContent').classList.add('authenticated');
            
            if (SECURITY_CONFIG.showWatermark) {
                document.getElementById('watermark').classList.remove('hidden');
            }
        }
        
        // Enter key handling
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const passwordStep = document.getElementById('passwordStep');
                const emailStep = document.getElementById('emailStep');
                
                if (!passwordStep.classList.contains('hidden')) {
                    validatePassword();
                } else if (!emailStep.classList.contains('hidden')) {
                    validateEmail();
                }
            }
        });
        
        // Check if already authenticated on page load
        window.addEventListener('load', function() {
            const session = getSession();
            if (session) {
                grantAccess();
            }
        });
        
        // Auto-focus first input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').focus();
        });
    </script>
</body>
</html>
